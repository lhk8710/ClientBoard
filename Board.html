<!DOCTYPE html>
<html>
<head>
<script type="text/JavaScript">
		var db;

		function createDB(){
			db = window.openDatabase("myBoard", "1.0", "게시판용 DB", 1024 * 1024);
 		}
 
 		function createTable(){
  			db.transaction(function(tx){
   				tx.executeSql("CREATE TABLE BOARD(COUNT INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, TITLE TEXT NOT NULL, NAME TEXT NOT NULL, CONTENTS TEXT NOT NULL, INPUTDAY text DEFAULT current_timestamp NOT NULL)"); 
  			});
 		}
 
 		function insertData(){
  			db.transaction(function(tx){
   				tx.executeSql("insert into BOARD(COUNT, TITLE, NAME, CONTENTS) values(NULL, ?,?,?)", [txTitle.value, txName.value, txContents.value]);
  			});
  			
  			myRefresh();
		}
 
 		function selectAllData(){
 			// all contents
  			db.transaction(function(tx){
   				tx.executeSql("select * from BOARD",[],
   					function(tx,result){            
    					for(var i = 0; i < result.rows.length; i++){
     						var row = result.rows.item(i);
  							var index = row['COUNT'];
  							
  							var con = row['CONTENTS'];
  							con = con.replace(/\n/gi,'<br/>');  
  							
  							document.getElementById('contentsList').innerHTML += "<tr><td BGCOLOR=#fff8dc>인덱스</td><td colspan=3>" + index + "</td></tr><tr><td BGCOLOR=#fff8dc>제목</td><td  colspan=3>"
  							+ row['TITLE'] + "</td></tr><tr><td  BGCOLOR=#fff8dc>이름</td><td>" + row['NAME'] + "</td><td BGCOLOR=#fff8dc>날짜</td><td>" + row['INPUTDAY'] + "</td></tr><tr><td colspan=5 BGCOLOR=#fff8dc>내용</td></tr><tr><td colspan=5>"
  							+ con + "</td></tr><tr><td><button id='txButton' value=" + index + " onClick='deleteData("+index+")'>지우기" 
  							+ index + "</button></td><td><button id='txUpdate' value="
  							+ index + " onClick='selectData("+index+")'>불러오기" + index + "</button></td><td><button id='txComment' value=" + index + " onClick='loadComment("+index+")'>댓글부르기"
  							+ index + "</button></td></tr>";
  							
  							index++;
 						}//for end        
   					}); //inner function end
  			}); //db.transaction end
 		}

  		function selectData(index){
 			// one contents
  			db.transaction(function(tx){
   				tx.executeSql("select * from BOARD where COUNT=?",[index],
   					function(tx, result){            
    					for(var i = 0; i < result.rows.length; i++){
     						var row = result.rows.item(i);
  							var number = row['COUNT'];
  							var title = row['TITLE'];
  							var name = row['NAME'];
  							var contents = row['CONTENTS'];
  
  							document.getElementById('buttonT').innerHTML = "<button id='txUpdate' value=" + number + " onClick='updateData("+number+"), myRefresh()'>수정</button>";

  							txTitle.value = title;
  							txName.value = name;
  							txContents.value = contents; // 위에다가 내용 표기 성공(불러오기)
 						}//for end         
   					}); //inner function end         
  				});
 		}
 
 
		function updateData(index){
			console.log(index + "번");
			console.log(txTitle.value);
			console.log(txName.value);
			console.log(txContents.value);
			console.log(index);

			db.transaction(function(tx){
   				tx.executeSql("update BOARD set TITLE=?, NAME=?, CONTENTS=? where COUNT=?", [txTitle.value, txName.value, txContents.value, index]); // 
  			});
		}

		function deleteData(index){
			console.log(index + "메소드 실행 테스트");
 			db.transaction(function(tx){
  				tx.executeSql("delete from BOARD where COUNT=?", [index]);
 			});
 			
 			myRefresh();
		}//funcion end
		
		function myRefresh(){
			setTimeout("history.go(0);", 10);
		}
		
		var winObject = null;
		
		function loadComment(index) {
		 	console.log(index + "번");
    		var settings = 'toolbar=0,directories=0,status=no,menubar=0,scrollbars=auto,resizable=no,height=200,width=200,left=0,top=0';
    		winObject = window.open("comment.html?index="+index, "", settings); 	
   		}
	</script>

<title>LHK 지식인</title>
</head>
<body onLoad="createDB(), createTable(), selectAllData()">

	<table align="center" border='1' id='mainTable'>
		<strong style=''><center>글 쓰기</center></strong>
		</caption>
		<th>제목</th>
		<td><input type="text" id="txTitle"></td>

		<tbody>
			<tr>
				<th>이름</th>
				<td><input type="text" id="txName"></td>
		</tbody>

		<tbody>
			<tr>
				<th>내용</th>
				<td><textarea id="txContents" rows="10" cols="100"></textarea></td>
		</tbody>



	</table>

	<table align="center" id="buttonT">
		<tr>
			<td><center>
					<button onClick="insertData()">입력</button>
				</center></td>
		</tr>
	</table>




	<br />
	<br />
	<hr width=1640 size=10 noshade>
	<br />

	<strong><center>글 리스트</center></strong>
	<!--<table id="contentsList" border = "1"><tr><td>인덱스</td><td>제목</td><td>날짜</td><td>이름</td><td>내용</td><td>지우기 버튼</td><td>불러오기 버튼</td></table>-->
	<table align="center" id="contentsList" border="1" cellpadding="2"
		cellspacing="5"></table>
	<br />
</body>

</html>
